<!DOCTYPE html>
<html lang="en">
<%- include("../layout/header.ejs") %>

  <body>
    <%- include("../layout/navBarnew.ejs") %>
      <div class="container-fluid mb-5" style="height: 100vh;">
        <div class="container ">
          <h4>Account</h4>
          <div class="d-flex gap-5 ">
            <%- include ("../layout/profileSidebar.ejs") %>
              <div class="col-7 border shadow rounded">
                <h4 style="padding: 1.5rem 10rem;">My Wishlist</h4>
                <hr style="width: 80%;margin: auto;">
                <div style="padding: 3rem 10rem;">
                  <% if (wishlist && wishlist.products.length> 0) { %>
                    <% wishlist.products.forEach(product=> { %>
                      <a href="/products/<%= product._id %>" class="text-decoration-none">
                      <div class="col-md-4">
                        <div class="card mb-4 shadow-sm">
                          <img src="/uploads/<%= product.prod_images[0] %>" alt="<%= product.prod_name %>"
                            class="card-img-top" />
                          <div class="card-body">
                            <p class="card-title">
                              <%= product.prod_name %>
                            </p>
                            <% if (product.discountedPrice) { %>
                              <p class="card-text">
                                <span class="text-decoration-line-through">₹<%= product.prod_mrp %></span>
                                <span class="text-danger">₹<%= product.discountedPrice.toFixed(2) %></span>
                              </p>
                            <% } else { %>
                              <p class="card-text">Price: ₹<%= product.prod_mrp %></p>
                            <% } %>
                            <% if (product.inStock) { %>
                              <p class="text-success">In Stock</p>
                            <% } else { %>
                              <p class="text-danger fw-bold">OUT OF STOCK</p>
                            <% } %>
                            <button class="removeFromWishlistBtn btn btn-danger"
                              data-product-id="<%= product._id %>">Remove from Wishlist</button>
                          </div>
                        </div>
                      </div>
                    </a>
                      <% }) %>
                        <% } else { %>
                          <p>Your wishlist is empty.</p>
                          <% } %>
                </div>
              </div>
          </div>
        </div>


      </div>
      </div>


      <script>
        document.querySelectorAll('.removeFromWishlistBtn').forEach(button => {
          button.addEventListener('click', function () {
            const productId = this.dataset.productId;

            fetch('/wishlist/remove', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ productId: productId })
            })
              .then(response => response.json())
              .then(data => {
                if (data.error) {
                  console.error(data.error);
                  Swal.fire({
                    title: 'Error',
                    text: 'Failed to remove product from wishlist.',
                    icon: 'error',
                    confirmButtonText: 'OK'
                  });
                } else {
                  Swal.fire({
                    title: 'Success',
                    text: 'Product removed from wishlist.',
                    icon: 'success',
                    confirmButtonText: 'OK'
                  });
                  window.location.reload();
                }
              })
              .catch(error => {
                console.error('Error removing product from wishlist:', error);
              });
          });
        });
      </script>
  </body>

</html>